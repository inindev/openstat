From e9da6f7b96ddefb85677cfd21d7ebc4bb6e1604a Mon Sep 17 00:00:00 2001
From: John Clark <inindev@gmail.com>
Date: Fri, 23 Apr 2021 00:12:17 -0400
Subject: [PATCH 3/3] u-boot target for resideo rth9580wf01 board

---
 package/boot/uboot-at91/Makefile              |   9 +-
 .../0001-fix-sprintf-compile-warning.patch    |  13 +
 .../0002-rule-to-build-cfg-files.patch        |  23 +
 ...s-for-resideo-rth9580wf01-thermostat.patch | 695 ++++++++++++++++++
 4 files changed, 739 insertions(+), 1 deletion(-)
 create mode 100644 package/boot/uboot-at91/patches/0001-fix-sprintf-compile-warning.patch
 create mode 100644 package/boot/uboot-at91/patches/0002-rule-to-build-cfg-files.patch
 create mode 100644 package/boot/uboot-at91/patches/0003-board-files-for-resideo-rth9580wf01-thermostat.patch

diff --git a/package/boot/uboot-at91/Makefile b/package/boot/uboot-at91/Makefile
index 3bbe0e4026..e1a9ca9181 100644
--- a/package/boot/uboot-at91/Makefile
+++ b/package/boot/uboot-at91/Makefile
@@ -105,6 +105,12 @@ define U-Boot/sama5d2_ptc_ek_mmc
   BUILD_DEVICES:=at91-sama5d2_ptc_ek
 endef
 
+define U-Boot/rth9580wf01_spiflash
+  NAME:=Resideo RTH9580WF01 board (SPI Flash)
+  BUILD_SUBTARGET:=sam9x
+  BUILD_DEVICES:=rth9580wf01
+endef
+
 UBOOT_TARGETS := \
 	at91sam9m10g45ek_nandflash \
 	at91sam9x5ek_nandflash \
@@ -118,7 +124,8 @@ UBOOT_TARGETS := \
     sama5d27_som1_ek_mmc \
     sama5d27_som1_ek_spiflash \
 	sama5d2_ptc_ek_nandflash \
-	sama5d2_ptc_ek_mmc
+	sama5d2_ptc_ek_mmc \
+	rth9580wf01_spiflash
 
 define Build/Compile
   +$(MAKE) $(PKG_JOBS) -C $(PKG_BUILD_DIR) \
diff --git a/package/boot/uboot-at91/patches/0001-fix-sprintf-compile-warning.patch b/package/boot/uboot-at91/patches/0001-fix-sprintf-compile-warning.patch
new file mode 100644
index 0000000000..7eab8f6389
--- /dev/null
+++ b/package/boot/uboot-at91/patches/0001-fix-sprintf-compile-warning.patch
@@ -0,0 +1,13 @@
+diff --git a/scripts/kconfig/confdata.c b/scripts/kconfig/confdata.c
+index 745cb93050..ab424e6054 100644
+--- a/scripts/kconfig/confdata.c
++++ b/scripts/kconfig/confdata.c
+@@ -743,7 +743,7 @@ int conf_write(const char *name)
+ 	struct menu *menu;
+ 	const char *basename;
+ 	const char *str;
+-	char dirname[PATH_MAX+1], tmpname[PATH_MAX+1], newname[PATH_MAX+1];
++	char dirname[PATH_MAX+1], tmpname[PATH_MAX+22], newname[PATH_MAX+8];
+ 	char *env;
+ 
+ 	dirname[0] = 0;
diff --git a/package/boot/uboot-at91/patches/0002-rule-to-build-cfg-files.patch b/package/boot/uboot-at91/patches/0002-rule-to-build-cfg-files.patch
new file mode 100644
index 0000000000..4afd4f0ca7
--- /dev/null
+++ b/package/boot/uboot-at91/patches/0002-rule-to-build-cfg-files.patch
@@ -0,0 +1,23 @@
+diff --git a/Makefile b/Makefile
+index d2a2a69096..3c949fc2a9 100644
+--- a/Makefile
++++ b/Makefile
+@@ -516,6 +516,9 @@ include/config/%.conf: $(KCONFIG_CONFIG) include/config/auto.conf.cmd
+ 	@# Otherwise, 'make silentoldconfig' would be invoked twice.
+ 	$(Q)touch include/config/auto.conf
+ 
++u-boot.cfg spl/u-boot.cfg tpl/u-boot.cfg:
++	$(Q)$(MAKE) -f $(srctree)/scripts/Makefile.autoconf $(@)
++
+ -include include/autoconf.mk
+ -include include/autoconf.mk.dep
+ 
+@@ -1267,7 +1270,7 @@ ifneq ($(KBUILD_SRC),)
+ endif
+ 
+ # prepare2 creates a makefile if using a separate output directory
+-prepare2: prepare3 outputmakefile
++prepare2: prepare3 outputmakefile cfg
+ 
+ prepare1: prepare2 $(version_h) $(timestamp_h) \
+                    include/config/auto.conf
diff --git a/package/boot/uboot-at91/patches/0003-board-files-for-resideo-rth9580wf01-thermostat.patch b/package/boot/uboot-at91/patches/0003-board-files-for-resideo-rth9580wf01-thermostat.patch
new file mode 100644
index 0000000000..ab344ac349
--- /dev/null
+++ b/package/boot/uboot-at91/patches/0003-board-files-for-resideo-rth9580wf01-thermostat.patch
@@ -0,0 +1,695 @@
+diff --git a/arch/arm/dts/Makefile b/arch/arm/dts/Makefile
+index 21c6e9fa97..8ffcc31a60 100644
+--- a/arch/arm/dts/Makefile
++++ b/arch/arm/dts/Makefile
+@@ -343,6 +343,8 @@ dtb-$(CONFIG_TARGET_AT91SAM9X5EK) += \
+ 	at91sam9x25ek.dtb	\
+ 	at91sam9x35ek.dtb
+ 
++dtb-$(CONFIG_TARGET_RTH9580WF01) += rth9580wf01.dtb
++
+ dtb-$(CONFIG_TARGET_AT91SAM9N12EK) += at91sam9n12ek.dtb
+ 
+ dtb-$(CONFIG_TARGET_SAMA5D2_PTC_EK) += \
+diff --git a/arch/arm/dts/rth9580wf01.dts b/arch/arm/dts/rth9580wf01.dts
+new file mode 100644
+index 0000000000..f93357470a
+--- /dev/null
++++ b/arch/arm/dts/rth9580wf01.dts
+@@ -0,0 +1,170 @@
++/*
++ * rth9580wf01.dts - Device Tree file for RTH9580WF01 Thermostat Board
++ *
++ * Licensed under GPLv2 or later.
++ */
++/dts-v1/;
++#include "rth9580wf01.dtsi"
++
++
++/ {
++	model = "Resideo RTH9580WF01";
++	compatible = "resideo,rth9580wf01", "atmel,at91sam9x5", "atmel,at91sam9";
++
++	chosen {
++//		bootargs = "rootfstype=squashfs,jffs2 noinitrd console=ttyS0,115200 fbcon=rotate:3";
++		bootargs = "console=ttyS0,115200 console=tty0 rootfstype=squashfs,jffs2 noinitrd fbcon=rotate:2";
++		stdout-path = "serial0:115200n8";
++		u-boot,dm-pre-reloc;
++	};
++
++	ahb {
++		apb {
++			i2c0: i2c@f8010000 {
++				status = "okay";
++			};
++
++			usart0: serial@f801c000 {
++				status = "okay";
++			};
++
++			hlcdc: hlcdc@f8038000 {
++				u-boot,dm-pre-reloc;
++				status = "okay";
++
++				hlcdc-display-controller {
++					pinctrl-names = "default";
++					pinctrl-0 = <&pinctrl_lcd_base &pinctrl_lcd_pwm &pinctrl_lcd_rgb888>;
++
++					port@0 {
++						hlcdc_panel_output: endpoint@0 {
++							reg = <0>;
++							remote-endpoint = <&panel_input>;
++						};
++					};
++				};
++			};
++
++			spi0: spi@f0000000 {
++				cs-gpios = <&pioA 14 0>, <0>, <0>, <0>;
++				status = "okay";
++				u-boot,dm-pre-reloc;
++
++				spi_flash@0 {
++					#address-cells = <1>;
++					#size-cells = <1>;
++					compatible = "jedec,spi-nor";
++					reg = <0>;
++					spi-max-frequency = <50000000>;
++					m25p,fast-read;
++
++					spl@0 {
++						label = "spl";
++						reg = <0x0 0x8000>;
++					};
++					uenv1@8000 {
++						label = "uenv1";
++						reg = <0x8000 0x4000>;
++					};
++					uenv2@c000 {
++						label = "uenv2";
++						reg = <0xc000 0x4000>;
++					};
++					uboot@10000 {
++						label = "uboot";
++						reg = <0x10000 0xb0000>;
++					};
++					kernel@c0000 {
++						label = "kernel";
++						reg = <0xc0000 0x400000>;
++					};
++					rootfs@4c0000 {
++						label = "rootfs";
++						reg = <0x4c0000 0x400000>;
++					};
++					data@8c0000 {
++						label = "data";
++						reg = <0x8c0000 0x740000>;
++					};
++				};
++			};
++
++			ssc0: ssc@f0010000 {
++				status = "okay";
++			};
++
++			dbgu: serial@fffff200 {
++				u-boot,dm-pre-reloc;
++				status = "okay";
++			};
++
++			watchdog@fffffe40 {
++				status = "okay";
++			};
++
++			rtc@fffffeb0 {
++				status = "okay";
++			};
++		};
++	};
++
++	memory {
++		reg = <0x20000000 0x1000000>;
++	};
++
++	clocks {
++		slow_xtal {
++			clock-frequency = <32768>;
++		};
++
++		main_xtal {
++			clock-frequency = <12000000>;
++		};
++	};
++
++	panel: panel {
++		compatible = "qiaodian,qd43003c0-40", "simple-panel";
++//		backlight = <&backlight>;
++		power-supply = <&panel_reg>;
++		#address-cells = <1>;
++		#size-cells = <0>;
++		status = "okay";
++
++		port@0 {
++			reg = <0>;
++			#address-cells = <1>;
++			#size-cells = <0>;
++
++			panel_input: endpoint@0 {
++				reg = <0>;
++				remote-endpoint = <&hlcdc_panel_output>;
++			};
++		};
++	};
++
++	panel_reg: panel_regulator {
++		compatible = "regulator-fixed";
++		regulator-name = "panel-power-supply";
++		regulator-min-microvolt = <3300000>;
++		regulator-max-microvolt = <3300000>;
++		status = "okay";
++	};
++
++	leds {
++		compatible = "gpio-leds";
++
++		pb18 {
++			label = "pb18";
++			gpios = <&pioB 18 GPIO_ACTIVE_LOW>;
++			linux,default-trigger = "heartbeat";
++		};
++
++		pd21 {
++			label = "pd21";
++			gpios = <&pioD 21 GPIO_ACTIVE_HIGH>;
++		};
++	};
++
++};
++
++
+diff --git a/arch/arm/dts/rth9580wf01.dtsi b/arch/arm/dts/rth9580wf01.dtsi
+new file mode 100644
+index 0000000000..76726ba257
+--- /dev/null
++++ b/arch/arm/dts/rth9580wf01.dtsi
+@@ -0,0 +1,91 @@
++/*
++ * rth9580wf01.dtsi - Device Tree Include file for RTH9580WF01 Thermostat Board
++ *
++ * Licensed under GPLv2 or later.
++ */
++
++#include "at91sam9x5.dtsi"
++#include "at91sam9x5_lcd.dtsi"
++#include "at91sam9x5_macb0.dtsi"
++
++
++/ {
++	model = "Atmel AT91SAM9G35 SoC";
++	compatible = "atmel,at91sam9g35", "atmel,at91sam9x5";
++
++	ahb {
++		apb {
++			i2c0: i2c@f8010000 {
++				qt1070: keyboard@1b {
++					compatible = "qt1070";
++					reg = <0x1b>;
++					interrupt-parent = <&pioA>;
++					interrupts = <7 0x0>;
++					pinctrl-names = "default";
++					pinctrl-0 = <&pinctrl_qt1070_irq>;
++					wakeup-source;
++				};
++			};
++
++			hlcdc: hlcdc@f8038000 {
++				atmel,vl-bpix = <4>;
++				atmel,guard-time = <1>;
++				pinctrl-names = "default";
++//				pinctrl-0 = <&pinctrl_lcd_base &pinctrl_lcd_pwm &pinctrl_lcd_rgb888>;
++
++				hlcdc-display-controller {
++					compatible = "atmel,hlcdc-display-controller";
++					#address-cells = <1>;
++					#size-cells = <0>;
++
++					port@0 {
++						#address-cells = <1>;
++						#size-cells = <0>;
++						reg = <0>;
++					};
++				};
++
++				display-timings {
++					u-boot,dm-pre-reloc;
++					480x272 {
++						clock-frequency = <24000000>;
++						hactive = <480>;
++						vactive = <272>;
++						hsync-len = <128>;
++						hfront-porch = <64>;
++						hback-porch = <64>;
++						vfront-porch = <22>;
++						vback-porch = <21>;
++						vsync-len = <2>;
++						u-boot,dm-pre-reloc;
++					};
++				};
++			};
++
++			adc0: adc@f804c000 {
++				atmel,adc-ts-wires = <4>;
++				atmel,adc-ts-pressure-threshold = <10000>;
++				status = "okay";
++			};
++
++			pinctrl@fffff400 {
++				board {
++					pinctrl_qt1070_irq: qt1070_irq {
++						atmel,pins =
++							<AT91_PIOA 7 AT91_PERIPH_GPIO AT91_PINCTRL_PULL_UP_DEGLITCH>;
++					};
++				};
++			};
++
++			pinctrl@fffff400 {
++				atmel,mux-mask = <
++				      /*    A         B          C     */
++				       0xffffffff 0xffe0399f 0xc000000c  /* pioA */
++				       0x000406ff 0x00047e3f 0x00000000  /* pioB */
++				       0xfdffffff 0x00000000 0xb83fffff  /* pioC */
++				       0x003fffff 0x003f8000 0x00000000  /* pioD */
++				      >;
++			};
++		};
++	};
++};
+diff --git a/arch/arm/mach-at91/Kconfig b/arch/arm/mach-at91/Kconfig
+index 62bef9ea76..71b13a9b5b 100644
+--- a/arch/arm/mach-at91/Kconfig
++++ b/arch/arm/mach-at91/Kconfig
+@@ -37,6 +37,13 @@ config TARGET_AT91SAM9261EK
+ 	bool "Atmel at91sam9261 reference board"
+ 	select CPU_ARM926EJS
+ 
++config TARGET_RTH9580WF01
++	bool "Resideo RTH9580WF01 thermostat board"
++	select CPU_ARM926EJS
++	select AT91SAM9X5
++	select BOARD_EARLY_INIT_F
++	select BOARD_LATE_INIT
++
+ config TARGET_PM9261
+ 	bool "Ronetix pm9261 board"
+ 	select CPU_ARM926EJS
+@@ -201,6 +208,7 @@ source "board/egnite/ethernut5/Kconfig"
+ source "board/esd/meesc/Kconfig"
+ source "board/l+g/vinco/Kconfig"
+ source "board/mini-box/picosam9g45/Kconfig"
++source "board/resideo/rth9580wf01/Kconfig"
+ source "board/ronetix/pm9261/Kconfig"
+ source "board/ronetix/pm9263/Kconfig"
+ source "board/ronetix/pm9g45/Kconfig"
+diff --git a/board/resideo/rth9580wf01/Kconfig b/board/resideo/rth9580wf01/Kconfig
+new file mode 100644
+index 0000000000..015b7c9601
+--- /dev/null
++++ b/board/resideo/rth9580wf01/Kconfig
+@@ -0,0 +1,12 @@
++if TARGET_RTH9580WF01
++
++config SYS_BOARD
++	default "rth9580wf01"
++
++config SYS_VENDOR
++	default "resideo"
++
++config SYS_CONFIG_NAME
++	default "rth9580wf01"
++
++endif
+diff --git a/board/resideo/rth9580wf01/MAINTAINERS b/board/resideo/rth9580wf01/MAINTAINERS
+new file mode 100644
+index 0000000000..0fccb46825
+--- /dev/null
++++ b/board/resideo/rth9580wf01/MAINTAINERS
+@@ -0,0 +1,6 @@
++RTH9580WF01 BOARD
++M:	John Clark <inindev@gmail.com>
++S:	Maintained
++F:	board/resideo/rth9580wf01/
++F:	include/configs/rth9580wf01.h
++F:	configs/rth9580wf01_spiflash_defconfig
+diff --git a/board/resideo/rth9580wf01/Makefile b/board/resideo/rth9580wf01/Makefile
+new file mode 100644
+index 0000000000..ceb848b36f
+--- /dev/null
++++ b/board/resideo/rth9580wf01/Makefile
+@@ -0,0 +1,5 @@
++#
++# SPDX-License-Identifier:	GPL-2.0+
++#
++
++obj-y += rth9580wf01.o
+diff --git a/board/resideo/rth9580wf01/rth9580wf01.c b/board/resideo/rth9580wf01/rth9580wf01.c
+new file mode 100644
+index 0000000000..49a56cad8b
+--- /dev/null
++++ b/board/resideo/rth9580wf01/rth9580wf01.c
+@@ -0,0 +1,122 @@
++/*
++ * Copyright (C) 2012 Atmel Corporation
++ *
++ * SPDX-License-Identifier:	GPL-2.0+
++ */
++
++#include <common.h>
++#include <dm.h>
++#include <asm/io.h>
++#include <asm/arch/at91sam9x5_matrix.h>
++#include <asm/arch/at91sam9_smc.h>
++#include <asm/arch/at91_common.h>
++#include <asm/arch/at91_rstc.h>
++#include <asm/arch/clk.h>
++#include <asm/arch/gpio.h>
++#include <debug_uart.h>
++#include <atmel_lcd.h>
++#include <version.h>
++#include <video.h>
++#ifdef CONFIG_DM_VIDEO
++#include <video_console.h>
++#endif
++
++DECLARE_GLOBAL_DATA_PTR;
++
++/* ------------------------------------------------------------------------- */
++/*
++ * miscelaneous platform dependent initialization
++ */
++
++#if defined(CONFIG_DM_VIDEO) && defined(CONFIG_ATMEL_HLCD)
++static int video_show_board_logo_info(void)
++{
++	int i;
++	u32 len = 0;
++	char buf[255];
++	char *corp = "Microchip Technology Inc.\n";
++	char temp[32];
++	struct udevice *dev, *con;
++	const char *s;
++	vidinfo_t logo_info;
++	int ret;
++
++	len += sprintf(&buf[len], "%s\n", U_BOOT_VERSION);
++	memcpy(&buf[len], corp, strlen(corp));
++	len += strlen(corp);
++	len += sprintf(&buf[len], "%s CPU at %s MHz\n", get_cpu_name(),
++			strmhz(temp, get_cpu_clk_rate()));
++
++	len += sprintf(&buf[len], "%d MB SDRAM, 16 MB Flash\n",
++		       CONFIG_SYS_SDRAM_SIZE >> 20);
++
++	ret = uclass_get_device(UCLASS_VIDEO, 0, &dev);
++	if (ret)
++		return ret;
++
++	get_microchip_logo_info(&logo_info);
++	ret = video_bmp_display(dev, logo_info.logo_addr,
++				logo_info.logo_x_offset,
++				logo_info.logo_y_offset + 2, false);
++	if (ret)
++		return ret;
++
++	ret = uclass_get_device(UCLASS_VIDEO_CONSOLE, 0, &con);
++	if (ret)
++		return ret;
++
++	vidconsole_position_cursor(con, 0, (logo_info.logo_height + 8));
++	for (s = buf, i = 0; i < len; s++, i++)
++		vidconsole_put_char(con, *s);
++
++	return 0;
++}
++#endif
++
++#ifdef CONFIG_BOARD_LATE_INIT
++int board_late_init(void)
++{
++#ifdef CONFIG_DM_VIDEO
++	video_show_board_logo_info();
++#endif
++	return 0;
++}
++#endif
++
++#ifdef CONFIG_DEBUG_UART_BOARD_INIT
++void board_debug_uart_init(void)
++{
++	at91_seriald_hw_init();
++}
++#endif
++
++#ifdef CONFIG_BOARD_EARLY_INIT_F
++int board_early_init_f(void)
++{
++#ifdef CONFIG_DEBUG_UART
++	debug_uart_init();
++#endif
++	return 0;
++}
++#endif
++
++int board_init(void)
++{
++	/* arch number of AT91SAM9X5EK-Board */
++	gd->bd->bi_arch_number = MACH_TYPE_AT91SAM9X5EK;
++
++	/* adress of boot parameters */
++	gd->bd->bi_boot_params = CONFIG_SYS_SDRAM_BASE + 0x100;
++
++#if defined(CONFIG_USB_OHCI_NEW) || defined(CONFIG_USB_EHCI)
++	at91_uhp_hw_init();
++#endif
++	return 0;
++}
++
++int dram_init(void)
++{
++	gd->ram_size = get_ram_size((void *) CONFIG_SYS_SDRAM_BASE,
++					CONFIG_SYS_SDRAM_SIZE);
++	return 0;
++}
+diff --git a/configs/rth9580wf01_spiflash_defconfig b/configs/rth9580wf01_spiflash_defconfig
+new file mode 100644
+index 0000000000..c97a0a2ce1
+--- /dev/null
++++ b/configs/rth9580wf01_spiflash_defconfig
+@@ -0,0 +1,69 @@
++CONFIG_ARM=y
++CONFIG_ARCH_AT91=y
++CONFIG_TARGET_RTH9580WF01=y
++CONFIG_SYS_MALLOC_F_LEN=0x2000
++CONFIG_DEFAULT_DEVICE_TREE="rth9580wf01"
++CONFIG_SYS_EXTRA_OPTIONS="AT91SAM9X5"
++CONFIG_SPI_BOOT=y
++# CONFIG_CONSOLE_MUX is not set
++CONFIG_SYS_CONSOLE_IS_IN_ENV=y
++CONFIG_HUSH_PARSER=y
++CONFIG_SYS_PROMPT="uboot> "
++CONFIG_CMD_BOOTZ=y
++# CONFIG_CMD_BOOTEFI is not set
++# CONFIG_CMD_ELF is not set
++# CONFIG_CMD_IMLS is not set
++CONFIG_CMD_MEMINFO=y
++# CONFIG_CMD_FLASH is not set
++CONFIG_CMD_SF=y
++CONFIG_CMD_USB=y
++# CONFIG_CMD_FPGA is not set
++CONFIG_CMD_GPIO=y
++# CONFIG_CMD_SETEXPR is not set
++# CONFIG_CMD_NET is not set
++CONFIG_CMD_DHCP=y
++CONFIG_CMD_PING=y
++# CONFIG_PARTITIONS is not set
++CONFIG_OF_CONTROL=y
++CONFIG_NET=y
++CONFIG_DM=y
++CONFIG_REGMAP=y
++CONFIG_SPL_REGMAP=y
++CONFIG_SYSCON=y
++CONFIG_SPL_SYSCON=y
++CONFIG_CLK=y
++CONFIG_CLK_AT91=y
++CONFIG_DM_GPIO=y
++CONFIG_AT91_GPIO=y
++# CONFIG_MMC is not set
++CONFIG_MTD=y
++CONFIG_DM_SPI_FLASH=y
++CONFIG_SPI_FLASH=y
++CONFIG_SPI_FLASH_ATMEL=y
++CONFIG_SPI_FLASH_ISSI=y
++CONFIG_SPI_FLASH_WINBOND=y
++CONFIG_SPI_FLASH_MTD=y
++CONFIG_DM_ETH=y
++CONFIG_MACB=y
++CONFIG_PINCTRL=y
++CONFIG_PINCTRL_AT91=y
++CONFIG_DM_SERIAL=y
++CONFIG_DEBUG_UART=y
++CONFIG_DEBUG_UART_ATMEL=y
++CONFIG_DEBUG_UART_BASE=0xfffff200
++CONFIG_DEBUG_UART_CLOCK=132000000
++CONFIG_DEBUG_UART_BOARD_INIT=y
++CONFIG_DEBUG_UART_ANNOUNCE=y
++CONFIG_ATMEL_USART=y
++CONFIG_DM_SPI=y
++CONFIG_ATMEL_SPI=y
++CONFIG_USB=y
++CONFIG_DM_USB=y
++CONFIG_USB_EHCI_HCD=y
++CONFIG_USB_STORAGE=y
++CONFIG_DM_VIDEO=y
++# CONFIG_VIDEO_BPP8 is not set
++# CONFIG_VIDEO_BPP32 is not set
++CONFIG_CONSOLE_ROTATION=y
++CONFIG_ATMEL_HLCD=y
++CONFIG_SMBIOS_MANUFACTURER="atmel"
+diff --git a/drivers/mtd/spi/Kconfig b/drivers/mtd/spi/Kconfig
+index 8eaf6814b6..8c5b8fa4bc 100644
+--- a/drivers/mtd/spi/Kconfig
++++ b/drivers/mtd/spi/Kconfig
+@@ -72,6 +72,11 @@ config SPI_FLASH_GIGADEVICE
+ 	help
+ 	  Add support for various GigaDevice SPI flash chips (GD25xxx)
+ 
++config SPI_FLASH_ISSI
++	bool "ISSI SPI flash support"
++	help
++	  Add support for various ISSI SPI flash chips (ISxxx)
++
+ config SPI_FLASH_MACRONIX
+ 	bool "Macronix SPI flash support"
+ 	help
+diff --git a/include/configs/rth9580wf01.h b/include/configs/rth9580wf01.h
+new file mode 100644
+index 0000000000..738b16b544
+--- /dev/null
++++ b/include/configs/rth9580wf01.h
+@@ -0,0 +1,117 @@
++/*
++ * configuation settings for the rth9580wf01 board
++ *
++ * SPDX-License-Identifier:	GPL-2.0+
++ */
++
++#ifndef __RTH9580WF01_H__
++#define __RTH9580WF01_H__
++
++#include <asm/hardware.h>
++
++#define CONFIG_SYS_TEXT_BASE		0x20f50000
++
++/* ARM asynchronous clock */
++#define CONFIG_SYS_AT91_SLOW_CLOCK	32768
++#define CONFIG_SYS_AT91_MAIN_CLOCK	12000000	/* 12 MHz crystal */
++
++#define CONFIG_AT91SAM9X5EK
++
++#define CONFIG_CMDLINE_TAG		/* enable passing of ATAGs */
++#define CONFIG_SETUP_MEMORY_TAGS
++#define CONFIG_INITRD_TAG
++#define CONFIG_SKIP_LOWLEVEL_INIT
++
++/* general purpose I/O */
++#define CONFIG_ATMEL_LEGACY		/* required until (g)pio is fixed */
++
++/* LCD */
++#ifdef CONFIG_ATMEL_HLCD
++#define CONFIG_SYS_WHITE_ON_BLACK
++#endif
++
++/* BOOTP options */
++#define CONFIG_BOOTP_BOOTFILESIZE
++#define CONFIG_BOOTP_BOOTPATH
++#define CONFIG_BOOTP_GATEWAY
++#define CONFIG_BOOTP_HOSTNAME
++
++/* SDRAM */
++#define CONFIG_NR_DRAM_BANKS		1
++#define CONFIG_SYS_SDRAM_BASE		0x20000000
++#define CONFIG_SYS_SDRAM_SIZE		0x01000000	/* 16 megs */
++
++#define CONFIG_SYS_INIT_SP_ADDR \
++	(CONFIG_SYS_SDRAM_BASE + 16 * 1024 - GENERATED_GBL_DATA_SIZE)
++
++/* MTD */
++#define CONFIG_MTD_DEVICE
++#define CONFIG_CMD_MTDPARTS
++#define CONFIG_MTD_PARTITIONS
++#define CONFIG_RBTREE
++#define CONFIG_LZO
++
++/*
++ * SPI NOR
++ */
++#ifdef CONFIG_CMD_SF
++#define CONFIG_SF_DEFAULT_BUS		0
++#define CONFIG_SF_DEFAULT_CS		0
++#define CONFIG_SF_DEFAULT_MODE		SPI_MODE_0
++#define CONFIG_SF_DEFAULT_SPEED		50000000
++#endif
++
++/* USB */
++#ifdef CONFIG_CMD_USB
++#ifndef CONFIG_USB_EHCI
++#define CONFIG_USB_ATMEL
++#define CONFIG_USB_ATMEL_CLK_SEL_UPLL
++#define CONFIG_USB_OHCI_NEW
++#define CONFIG_SYS_USB_OHCI_CPU_INIT
++#define CONFIG_SYS_USB_OHCI_REGS_BASE		ATMEL_BASE_OHCI
++#define CONFIG_SYS_USB_OHCI_SLOT_NAME		"at91sam9x5"
++#define CONFIG_SYS_USB_OHCI_MAX_ROOT_PORTS	3
++#endif
++#endif
++
++#define CONFIG_SYS_LOAD_ADDR		0x20f50000	/* load address */
++
++#define CONFIG_SYS_MEMTEST_START	(CONFIG_SYS_SDRAM_BASE + SZ_32K)
++#define CONFIG_SYS_MEMTEST_END		(CONFIG_SYS_TEXT_BASE - SZ_1M)
++
++/* bootstrap + u-boot + env1 + env2 + linux in spi flash */
++#define CONFIG_ENV_IS_IN_SPI_FLASH
++#define CONFIG_SYS_REDUNDAND_ENVIRONMENT
++#define CONFIG_ENV_SECT_SIZE		0x1000
++#define CONFIG_ENV_SIZE			0x4000
++#define CONFIG_ENV_OFFSET		0x8000
++#define CONFIG_ENV_OFFSET_REDUND	(CONFIG_ENV_OFFSET + CONFIG_ENV_SIZE)
++#define CONFIG_ENV_SPI_BUS		0
++#define CONFIG_ENV_SPI_CS		0
++#define CONFIG_ENV_SPI_MODE		SPI_MODE_0
++#define CONFIG_ENV_SPI_MAX_HZ		50000000
++
++#define CONFIG_LZMA
++#define CONFIG_BOOTCOMMAND	"sf probe 0; " \
++				"sf read 0x20800000 0xc0000 0x400000; " \
++				"bootm 0x20800000 - 0x${fdtcontroladdr}"
++
++#define CONFIG_BAUDRATE		115200
++
++#define CONFIG_SYS_CBSIZE	256
++#define CONFIG_SYS_MAXARGS	16
++#define CONFIG_SYS_LONGHELP
++#define CONFIG_CMDLINE_EDITING
++#define CONFIG_AUTO_COMPLETE
++
++/*
++ * Size of malloc() pool
++ */
++#define CONFIG_SYS_MALLOC_LEN		(256 << 10)	/* reserve 256k for malloc() */
++
++#define CONFIG_SYS_MASTER_CLOCK		132096000
++#define CONFIG_SYS_AT91_PLLA		0x20c73f03
++#define CONFIG_SYS_MCKR			0x1301
++#define CONFIG_SYS_MCKR_CSS		0x1302
++
++#endif /* __RTH9580WF01_H__ */
-- 
2.20.1

